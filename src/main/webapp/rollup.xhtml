<?xml version="1.0" encoding="UTF-8" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:p="http://primefaces.org/ui"
    xmlns:f="http://java.sun.com/jsf/core" template="/template/layout.xhtml">
    <ui:define name="css">
        <style type="text/css">
.ui-datatable-tablewrapper {
	font-size: small;
	font-family: system-ui;
}

.rollup-text-align-center {
	text-align: center;
}

.ui-panelgrid-content {
	align-items: center;
}

.rollup-text-align-left {
	text-align: left;
}

.rollup-text-align-right {
	text-align: right;
}

.rollups-table-header {
	font-weight: bold;
	align-items: center;
}

.negative {
	color: red;
}

.div-75 {
	float: left;
	width: 70%;
	padding: 3px;
}
.div-25 {
	float: left;
	width: 30%;
	padding: 3px;
}


.ui-datatable-even{
	background: #6ab2eo;
	color: #FFFFFF
}


.ui-datatable-odd{
	background-color: #6ab2eo;
}

#rollupForm\:tabViewRollUps\:tabHHFF {
	overflow: hidden;
}
        </style>
    </ui:define>
    <ui:define name="js">
        <script>
		function year_onblur(e) {
		    var message = '';
		    if (isNaN(e.value)) {
		        message = 'The year must be a number';
		    } else {
		        if (!(#{rollupControllerBean.currYear} >= parseInt(e.value) &amp;&amp; parseInt(e.value) >= 1950)) {
		            message = 'The year must be between 1950 and #{rollupControllerBean.currYear}';
		        }
		    }
		    if (message !== '') {
		        $("#dialogMsgId").get(0).innerText = message;
		        PF('dlgMessage').show();
		        e.focus();
		    }
		}
        </script>
    </ui:define>
    <ui:define name="title">
        <title>${rollupControllerBean.title}</title>
    </ui:define>
    <ui:define name="header">
        <h1>
            <i class="fa fa-cogs fa-lg"></i>
            <h:outputText value=" ${rollupControllerBean.title}" />
        </h1>
    </ui:define>
    <ui:define name="content">
        <h:form id="#{rollupControllerBean.formNameId}">
            <div class="card" style="overflow: hidden" id="rollupcardId">
                <p:log id="log" rendered="false"/>
                <p:growl id="messages" showDetail="true" />
                <h:messages globalOnly="true" id="globalMsgId" />
                <p:toolbar>
                    <p:toolbarGroup>
                        <p:commandButton id="start-rollup-process-button" value="#{rollupControllerBean.processButtonMessage}" icon="pi pi-cog" actionListener="#{rollupControllerBean.processSelectedRollUps}" styleClass="#{rollupControllerBean.processButtonStyleClass}" disabled="#{!rollupControllerBean.hasSelectedRollUps()}" update="@this">
                            <p:confirm header="Confirmation" message="Start Processing RollUps?" icon="pi pi-exclamation-triangle" />
                        </p:commandButton>
                    </p:toolbarGroup>
                </p:toolbar>
                <p:tabView id="tabViewRollUps" widgetVar="wvTabViewRollUps">
                    <p:ajax event="tabChange" listener="#{rollupControllerBean.onTabChange}" update=":#{rollupControllerBean.formNameId}:messages" />
                    <p:ajax event="tabClose" listener="#{rollupControllerBean.onTabClose}" update=":#{rollupControllerBean.formNameId}:messages" />
                    <p:tab title="RollUps" id="tabRollUp">
                        <p:dataTable id="dt-rollup"
                            widgetVar="dtRollUps"
                            var="rollup" value="#{rollupControllerBean.lstRollUps}"
                            reflow="true" styleClass="ui-datatable-tablewrapper"
                            selection="#{rollupControllerBean.lstSelectedRollups}"
                            rowKey="#{rollup.companyid}" paginator="true"
                            rows="15" resizableColumns="true" resizeMode="expand"
                            tableStyle="width:auto"
                            rowSelectMode="new" paginatorPosition="bottom"
                            rowIndexVar="ruItem">
                            <f:facet name="header">
                                <div class="rollups-table-header rollup-text-align-center">
                                    <span>ROLLUP</span>
                                </div>
                            </f:facet>
                            <p:ajax event="rowSelect" update=":#{rollupControllerBean.formNameId}:start-rollup-process-button" />
                            <p:ajax event="rowUnselect" update=":#{rollupControllerBean.formNameId}:start-rollup-process-button" />
                            <p:ajax event="rowSelectCheckbox" update=":#{rollupControllerBean.formNameId}:start-rollup-process-button" />
                            <p:ajax event="rowUnselectCheckbox" update=":#{rollupControllerBean.formNameId}:start-rollup-process-button" />
                            <p:ajax event="toggleSelect" update=":#{rollupControllerBean.formNameId}:start-rollup-process-button" />
                            <p:column selectionMode="multiple" exportable="false" width="5%"></p:column>
                            <p:column headerText="Entity" styleClass="rollup-text-align-left" sortBy="#{rollup.entity}" filterBy="#{rollup.entity}">
                                <h:outputText value="#{rollup.entity}" />
                            </p:column>
                            <p:column headerText="Application" styleClass="rollup-text-align-left">
                                <h:outputText value="#{rollup.rapplication}" />
                            </p:column>
                            <p:column headerText="Scenario" styleClass="rollup-text-align-left">
                                <h:outputText value="#{rollup.scenario}" />
                            </p:column>
                            <p:column headerText="Year" sortBy="#{rollup.ryear}" filterBy="#{rollup.ryear}">
                                <h:inputText id="year" size="4" maxlength="4" required="true" value="#{rollup.ryear}" onblur="year_onblur(this)">
                                    <f:ajax event="change" listener="#{rollup.changeItemValue}" execute="@this" render="@none" />
                                </h:inputText>
                            </p:column>
                            <p:column headerText="Period" sortBy="#{rollup.rperiod}" filterBy="#{rollup.rperiod}">
                                <h:selectOneMenu id="month" value="#{rollup.rperiod}">
                                    <f:selectItem itemLabel="JAN" itemValue="01" />
                                    <f:selectItem itemLabel="FEB" itemValue="02" />
                                    <f:selectItem itemLabel="MAR" itemValue="03" />
                                    <f:selectItem itemLabel="APR" itemValue="04" />
                                    <f:selectItem itemLabel="MAY" itemValue="05" />
                                    <f:selectItem itemLabel="JUN" itemValue="06" />
                                    <f:selectItem itemLabel="JUL" itemValue="07" />
                                    <f:selectItem itemLabel="AUG" itemValue="08" />
                                    <f:selectItem itemLabel="SEP" itemValue="09" />
                                    <f:selectItem itemLabel="OCT" itemValue="10" />
                                    <f:selectItem itemLabel="NOV" itemValue="11" />
                                    <f:selectItem itemLabel="DEC" itemValue="12" />
                                    <f:ajax event="change" listener="#{rollup.changeItemValue}" execute="@this" render="@none" />
                                </h:selectOneMenu>
                            </p:column>
                            <p:column headerText="view">
                                <h:outputText value="#{rollup.rview}" />
                            </p:column>
                            <p:column headerText="value">
                                <h:outputText value="#{rollup.rvalue}" />
                            </p:column>
                             <p:column headerText=" balance Validation" styleClass="rollup-text-align-center" style="background-color: #1E90FF">
                                <i class="#{rollup.trialBalanceIcon}" id="i-ru-tb-#{rollup.companyid}">
                                    <h:outputText value="#{rollup.attribute1}" class="#{empty rollup.trialBalanceIcon ? '': 'sr-only'}" />
                                </i>
                            </p:column>
                            <p:column headerText="Trading Partner Validation" styleClass="rollup-text-align-center" style="background-color: #1E90FF ">
                                <i class="#{rollup.trialBalanceIcon}" id="i-ru-tb-#{rollup.companyid}">
                                    <h:outputText value="#{rollup.attribute4}" class="#{empty rollup.trialBalanceIcon ? '': 'sr-only'}" />
                                </i>
                            </p:column>
                            <p:column headerText="Cost Center Validation" styleClass="rollup-text-align-center" style="background-color: #1E90FF">
                                <i class="#{rollup.trialBalanceIcon}" id="i-ru-tb-#{rollup.companyid}">
                                    <h:outputText value="#{rollup.attribute5}" class="#{empty rollup.trialBalanceIcon ? '': 'sr-only'}" />
                                </i>
                            </p:column>
                            
                            <p:column headerText="Accounts balance Vs ICP " styleClass="rollup-text-align-center" style="background-color: #1E90FF">
                                <i class="#{rollup.trialBalanceIcon}" id="i-ru-tb-#{rollup.companyid}">
                                    <h:outputText value="#{rollup.validations}" class="#{empty rollup.trialBalanceIcon ? '': 'sr-only'}" />
                                </i>
                            </p:column>
                            <p:column headerText="Finished Process " styleClass="rollup-text-align-center" style="background-color: #1E90FF">
                                <i class="#{rollup.trialBalanceIcon}" id="i-ru-tb-#{rollup.companyid}">
                                    <h:outputText value="#{rollup.attribute6}" class="#{empty rollup.trialBalanceIcon ? '': 'sr-only'}" />
                                </i>
                            </p:column>
                            <p:column headerText="View FFSS" exportable="false">
                                <p:commandButton id="btnView" icon="fa fa-search-plus" oncomplete="PF('wvTabViewRollUps').enable(1); PF('wvTabViewRollUps').select(1)" update="rollupForm:messages, rollupForm:tabViewRollUps:dt-hfm-tab-ffss, rollupForm:tabViewRollUps:dt-macthacc" styleClass="edit-button rounded-button ui-button-success" process="@this" alt="view detail">
                                    <f:setPropertyActionListener value="#{rollup}" target="#{rollupControllerBean.curRollUp}" />
                                </p:commandButton>
                            </p:column>
                             <p:column headerText="Generate HFM Layout" exportable="false">
                                <p:commandButton id="btngL"  icon="ui-icon-publish" oncomplete="PF('wvTabViewRollUps').enable(1); PF('wvTabViewRollUps').select(1)" update="rollupForm:messages, rollupForm:tabViewRollUps:dt-hfm-tab-ffss, rollupForm:tabViewRollUps:dt-macthacc" styleClass="rounded-button ui-button-secondary" process="@this" alt="generate Layout">
                                    
                                </p:commandButton>
                            </p:column>
                            <p:column headerText="View HFM Layout" exportable="false">
                                <p:commandButton id="btnViewL" icon="ui-icon-library-books" oncomplete="PF('wvTabViewRollUps').enable(1); PF('wvTabViewRollUps').select(1)" update="rollupForm:messages, rollupForm:tabViewRollUps:dt-hfm-tab-ffss, rollupForm:tabViewRollUps:dt-macthacc" styleClass="edit-button rounded-button ui-button-success" process="@this" alt="view detail layout">
                                    
                                </p:commandButton>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                    <p:tab title="FFSS" id="tabHHFF" disabled="true">
                        <div class="div-75" style="text-align : justify">
                            <p:dataTable id="dt-hfm-tab-ffss"
                                widgetVar="dtHfmFfss" var="hfmffss"
                                value="#{rollupControllerBean.lstHfmFfss}"
                                reflow="true" styleClass="hfmffss-table"
                                rowKey="#{hfmffss.companyid}" paginator="true"
                                rows="20" resizableColumns="true"
                                tableStyle="width:auto" stickyHeader="true" stripedRows="true"
                                resizeMode="expand" paginatorPosition="bottom" size="small">
                                <f:facet name="header">
                                    <p:toolbar id="toolbar-hfmffss">
                                        <p:toolbarGroup>
                                            <div class="hfmffss-table-header">
                                                <h:outputText value="FFSS " style="font-weight: bold" />
                                            </div>
                                        </p:toolbarGroup>
                                        <p:toolbarGroup align="right">
                                            <p:commandButton value="Export" id="btnExport" icon="fa fa-file-excel-o" styleClass="ui-button-help" title="Export to excel" ajax="false" disabled="#{empty rollupControllerBean.lstHfmFfss}">
                                                <p:dataExporter type="xls" target="tabHHFF" fileName="HFM_FFSS" pageOnly="true" />
                                            </p:commandButton>
                                        </p:toolbarGroup>
                                    </p:toolbar>
                                </f:facet>
                                <p:column headerText="Classification"  sortBy="#{hfmffss.classification}" filterBy="#{hfmffss.classification}">
                                    <h:outputText value="#{hfmffss.classification}" >
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Account Type"  sortBy="#{hfmffss.naturalb}" filterBy="#{hfmffss.naturalb}">
                                    <h:outputText value="#{hfmffss.naturalb}" >
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Hfmcode"  sortBy="#{hfmffss.hfmcode}" filterBy="#{hfmffss.hfmcode}">
                                    <h:outputText value="#{hfmffss.hfmcode}" >
                                     </h:outputText>
                                </p:column>
                                <p:column headerText="Description"  sortBy="#{hfmffss.description}" filterBy="#{hfmffss.description}">
                                    <h:outputText value="#{hfmffss.description}" >
                                    </h:outputText>
                                </p:column>
                                <p:column headerText="Balance"  sortBy="#{hfmffss.formatedBalance}" filterBy="#{hfmffss.formatedBalance}"
                                styleClass="rollup-text-align-right #{hfmffss.balance lt 0 ? 'negative' : ''}">
                                    <h:outputText value="#{hfmffss.formatedBalance}" >
                                     </h:outputText>
                                </p:column>
                                <p:column headerText="Currency Code"  sortBy="#{hfmffss.currencyCode}" filterBy="#{hfmffss.currencyCode}">
                                    <h:outputText value="#{hfmffss.currencyCode}"   >
                                     </h:outputText>
                                </p:column>
                               <p:column headerText="Rollup Errors"  sortBy="#{hfmffss.errortext}" filterBy="#{hfmffss.errortext}">
                                    <h:outputText value="#{hfmffss.errortext}"  style="text-align : justify">
                                     </h:outputText>
                                </p:column>
                                <p:column headerText="View FFSS Details" exportable="false">
                                    <p:commandButton id="btnViewDetail" icon="pi pi-eye"
                                        oncomplete="PF('wvTabViewRollUps').enable(2); PF('wvTabViewRollUps').select(2)"
                                        update="rollupForm:tabViewRollUps:dt-hfm-tab-ffss-details"
                                        styleClass="edit-button rounded-button ui-button-success"
                                        process="@this" alt="view detail" value="Details">
                                        <f:ajax execute="@this" listener="#{rollupControllerBean.curHfmffssClic}" event="click" />
                                        <f:setPropertyActionListener value="#{hfmffss}" target="#{rollupControllerBean.curHfmFfss}" />
                                    </p:commandButton>
                                </p:column>
                            </p:dataTable>
                        </div>
                        <div class="div-5">
                        <p:column>    </p:column>
                        
                        </div>
                        <div class="div-25">
                            <p:dataTable id="dt-macthacc"
                                widgetVar="matchaccount" var="matchacc"
                                value="#{rollupControllerBean.lstMatchAcc}" reflow="true"
                                styleClass="matchacc-table" rowKey="#{matchacc.companyid}"
                                paginator="true" rows="15" resizableColumns="true"   stripedRows="true"
                                resizeMode="expand" paginatorPosition="bottom" size="small">
                                <f:facet name="header">
                                    <div class="rollups-table-header">
                                        <h:outputText value="GLOBAL VALIDATION" />
                                    </div>
                                </f:facet>
                                <p:column headerText="Hfmcode"> 
                                    <h:outputText value="#{matchacc.hfmcode}" />
                                </p:column>
                                <p:column headerText="Description">
                                    <h:outputText value="#{matchacc.description}"></h:outputText>
                                </p:column>
                                <p:column headerText="Amount" styleClass="rollup-text-align-right #{matchacc.balance lt 0 ? 'negative' : ''}">
                                    <h:outputText value="#{matchacc.formatedamount}" />
                                </p:column>
                            </p:dataTable>
                        </div>
                    </p:tab>
                    <p:tab title="FFSS Detail" id="tabHHFFDetail" disabled="true">
                        <p:dataTable id="dt-hfm-tab-ffss-details" 
                            widgetVar="dtHfmFfssDetails"
                            var="hfmffssDetail"
                            value="#{rollupControllerBean.lstHfmFfssDetails}"
                            reflow="true" styleClass="ui-datatable-tablewrapper"
                            paginator="true" rows="10" resizableColumns="true" stickyHeader="true" stripedRows="true" tableStyle="width:auto" 
                            resizeMode="expand" paginatorPosition="bottom">
                            <f:facet name="header">
                                <div class="hfmffss-table-header">
                                    <span style="font-weight: bold"> FFSS DETAILS</span>
                                </div>
                            </f:facet>
                            <p:column headerText="ACCOUNT ID"  sortBy="#{hfmffssDetail.id.accountid}" filterBy="#{hfmffssDetail.id.accountid}">
                                <h:outputText value="#{hfmffssDetail.id.accountid}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="COST CENTER" sortBy="#{hfmffssDetail.id.costcenter}" filterBy="#{hfmffssDetail.id.costcenter}">
                                <h:outputText value="#{hfmffssDetail.id.costcenter}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="AMOUNT" sortBy="#{hfmffssDetail.id.amount}" filterBy="#{hfmffssDetail.id.amount}">
                                <h:outputText value="#{hfmffssDetail.id.amount}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="PARTNER ID" sortBy="#{hfmffssDetail.id.partnerid}" filterBy="#{hfmffssDetail.id.partnerid}">
                                <h:outputText value="#{hfmffssDetail.id.partnerid}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="ICP" sortBy="#{hfmffssDetail.id.icp}" filterBy="#{hfmffssDetail.id.icp}">
                                <h:outputText value="#{hfmffssDetail.id.icp}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="BATCH NAME" sortBy="#{hfmffssDetail.batchName}" filterBy="#{hfmffssDetail.batchName}">
                                <h:outputText value="#{hfmffssDetail.batchName}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="DOC NUMBER" sortBy="#{hfmffssDetail.docnumber}" filterBy="#{hfmffssDetail.docnumber}">
                                <h:outputText value="#{hfmffssDetail.docnumber}" >
                                </h:outputText>
                            </p:column>
                            <p:column headerText="TP NAME" sortBy="#{hfmffssDetail.tpname}" filterBy="#{hfmffssDetail.tpname}">
                                <h:outputText value="#{hfmffssDetail.tpname}" >
                                </h:outputText>
                            </p:column>
                        </p:dataTable>
                    </p:tab>
                </p:tabView>
                <p:confirmDialog global="true" showEffect="fade" width="300">
                    <p:commandButton value="Yes" type="button" styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no ui-button-secondary" icon="pi pi-times" />
                </p:confirmDialog>
            </div>
            <p:dialog header="Information" widgetVar="dlgMessage" id="dlgMessageId" minHeight="40" minWidth="350" showEffect="fade" modal="true" closable="true">
                <p class="p-m-0" id="dialogMsgId"></p>
                <f:facet name="footer">
                    <p:commandButton type="button" value="Ok" style="width: 5rem" onclick="PF('dlgMessage').hide()" />
                </f:facet>
            </p:dialog>
        </h:form>
    </ui:define>
</ui:composition>
